chrome.runtime.onMessage.addListener((function(e,o,t){if("getPPTUrl"===e.action)return chrome.storage.local.get(["pptUrl"],(function(e){t({pptUrl:e.pptUrl})})),!0;{let o=e.data;!function(e,o,t=3e3,n=""){if(chrome.notifications){let c={type:"basic",title:e,message:o,iconUrl:chrome.runtime.getURL("icon.png")};chrome.notifications.create("",c,(function(e){function o(e){console.log("click notification",n),n&&(console.log("open url",n),chrome.tabs.create({url:n})),chrome.notifications.clear(e,(function(){}))}chrome.notifications.onClicked.addListener(o),setTimeout((function(){chrome.notifications.clear(e,(function(){})),chrome.notifications.onClicked.removeListener(o)}),t)}))}else console.error("chrome.notifications is not available")}(o.title,o.message,o.closeTime,o.url),t("已执行弹窗")}})),chrome.webRequest.onCompleted.addListener((function(e){e.url.includes("/api/uploads/reference/document/")&&fetch(e.url).then((e=>e.json())).then((e=>{e&&e.url?chrome.storage.local.set({pptUrl:e.url},(()=>{console.log("PPT URL 已存储:",e.url)})):console.log("fail to save pptUrl")})).catch((e=>console.error("获取数据失败:",e)))}),{urls:["https://courses.zju.edu.cn/api/uploads/reference/document/*/url"]});